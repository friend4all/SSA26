# 22. Настройка системы мониторинга

### Вариант реализации:

#### 

#### srv2-cod (alt-server):

* Устанавливаем пакет **zabbix-server-pgsql**:

```bash
apt-get update && apt-get install -y zabbix-server-pgsql
```

* Создаём пользоавтеля **zabbix\_user** в базе данных **PostgreSQL**:

```bash
su - postgres -s /bin/sh -c 'createuser --no-superuser --no-createdb --no-createrole --encrypted --pwprompt zabbix_user'
```

* + После запуска данной команды - задаём в качестве пароля для пользователя **zabbix\_user** - пароль **P@ssw0rdZabbix** и подтверждаем его:

![](../images/22_image_5ac1492736.png)

* Создаём базу данных с именем **zabbix**:

```bash
su - postgres -s /bin/sh -c 'createdb -O zabbix_user zabbix'
```

* Выполняем перезагрузку службы **postgresql**:

```bash
systemctl restart postgresql
```

* Добавляем в базу данные для веб-интерфейса:

```bash
su - postgres -s /bin/sh -c 'psql -U zabbix_user -f /usr/share/doc/zabbix-common-database-pgsql-*/schema.sql zabbix'
```

```bash
su - postgres -s /bin/sh -c 'psql -U zabbix_user -f /usr/share/doc/zabbix-common-database-pgsql-*/images.sql zabbix'
```

```bash
su - postgres -s /bin/sh -c 'psql -U zabbix_user -f /usr/share/doc/zabbix-common-database-pgsql-*/data.sql zabbix'
```

#### srv1-cod (alt-server):

* Устанавливаем пакеты для веб-сервера **apache2**:

```bash
apt-get install -y apache2 apache2-mod_{php8.2,ssl}
```

* Включаем и добавляем в автозагрузку службу отвечающую за веб-сервер **apache2**:

```bash
systemctl enable --now httpd2
```

* Установим **PHP** и необходимые модули для корректной работы:

```bash
apt-get install -y php8.2 php8.2-{mbstring,sockets,gd,xmlreader,pgsql,ldap,openssl}
```

* Меняем некоторые опции **php** в файле **/etc/php/8.2/apache2-mod\_php/php.ini**:

* + Находим следующие параметры и приводим их к следующему виду:

![](../images/22_image__1__ac57a41a13.png)

![](../images/22_image__2__2c45abb5f5.png)

![](../images/22_image__3__fe64f242ff.png)

![](../images/22_image__4__d13cb57c96.png)

* Перезапускаем службу отвечающую за веб-сервер **apache2**:

```bash
systemctl restrart httpd2
```

* Устанавливаем **zabbix-server-pgsql**:

```bash
apt-get install -y zabbix-server-pgsql
```

* Вносим изменения в конфигурационный файл **/etc/zabbix/zabbix\_server.conf:**
  + Добавляем следующие изменения:

![](../images/22_image__5__a70fc7b1bb.png)

* Добавим **Zabbix-сервер** в автозапуск и запустить его:

```bash
systemctl enable --now zabbix_pgsql
```

* Установка веб-интерфейса Zabbix:

```bash
apt-get install zabbix-phpfrontend-{apache2,php8.2} -y
```

* Создаём файл конфигурации Virtualhost для Zabbix **/etc/httpd/conf/sites-available/zabbix.conf**:
  + Cодержимое:

![](../images/22_image__8__65657329d5.png)

* Копируем ранее созданные сертификаты:

```bash
 cp /var/ca/newcerts/monitoring.crt /var/lib/ssl/certs/
```

```bash
 cp /var/ca/newcerts/monitoring.key /var/lib/ssl/private/
```

* Добавляем символьную ссылку на файл **/etc/httpd/conf/sites-available/zabbix.conf**:

```bash
ln -s /etc/httpd/conf/sites-available/zabbix.conf /etc/httpd/conf/sites-enabled/
```

* Включаем модуль **ssl** и **rewrite**, а также порт **https**:

```bash
a2enmod ssl; a2enmod rewrite; a2enport https
```

* Проверяем синтаксис конфигурационного файла **/etc/httpd/conf/sites-available/zabbix.conf**:

```bash
apachectl -t
```

* + Результат:

![](../images/22_image__7__70b2b3cec4.png)

* Назначаем владельца и группу владельцев для файлов проекта **zabbix**:

```bash
chow -R apache2:apache2 /var/www/webapps/zabbix
```

* Перезагружаем службу **httpd2**:

```bash
systemctl restart httpd2
```

#### admin-cod (alt-workstation):

* Продолжаем установку **zabbix** - через веб-интерфейс:  
  + переходим на **[https://srv1-cod.cod.ssa2026.region](https://srv1-cod.cod.ssa2026.region/)** и нажимаем **Next step**:

![](../images/22_image__9__4b5ce05ec2.png)

* + нажимаем **Next step**:

![](../images/22_image__10__38c6f57484.png)

* + В качестве базы данных выбираем - **PostgreSQL**;
  + В качестве сервера базы данных указываем **IP** - адрес или имя **srv2-cod.cod.ssa2026.region****;**
  + Указываем имя созданной базы данных **zabbix;**
  + Указываем имя созданного пользователя **zabbix\_user;**
  + Указываем пароль для пользователя zabbix  **P@ssw0rdZabbix**;
  + Нажимаем **Next step**

![](../images/22_image__11__a297617e90.png)

* + при необходимости задаём имя серверу и нажимаем **Next step**

![](../images/22_image__12__cf71a96702.png)

* + проверяем введённые ранее параметры и нажимаем **Next step**

![](../images/22_image__13__f9a3d360a9.png)

* + нажимаем **Finish**

![](../images/22_image__14__6769d56e9e.png)

* + выполняем вход из под пользователя по умолчанию: **Admin** с паролем: **zabbix**

![](../images/22_image__15__26f2fe69bf.png)

* Результат:

![](../images/22_image__17__e4e3ea561a.png)

* В качестве пароля для пользователя**Admin -**необходимо установить**P@ssw0rd:**
  + переходим в настройки аутентификации и снимаем галочку, которая запрещает использование слабых паролей

![](../images/22_image__18__05df0c67a3.png)

* Задаём новый пароль **P@ssw0rd**- для пользователя **Admin**

![](../images/22_image__19__02fe8a1733.png)

#### srv1-cod, srv2-cod, dc-a, sw1-cod, sw2-cod, sw1-a, sw2-a (alt-server):

* Устанавливаем необходимый пакет **zabbix-agent**:

```bash
apt-get install zabbix-agent -y
```

* Редактируем конфигурационный файл **/etc/zabbix/zabbix\_agentd.conf:**
  + вносим следующие изменения:

![](../images/22_image__20__3167dc8429.png)

* + в поле **Hostname** необходимо указывать полное доменное имя соответствующего хоста

![](../images/22_image__21__60848e67af.png)

* Включаем и добавляем в автозагрузку службу **zabbix\_agentd**:

```bash
systemctl enable --now zabbix_agentd.service
```

#### admin-cod (alt-workstation):

* Переходим в веб-интерфейс управления **fw-cod:**

![](../images/22_image__24__6d1c5d9cd2.png)

* Результат:

![](../images/22_image__25__5de20c7680.png)

#### rtr-cod и rtr-a (ecorouter):

* Запуск сервиса SNMP:

```bash
rtr-cod(config)#snmp-server enable snmp
rtr-cod(config)#
```

* Настроить SNMP community:

```bash
 rtr-cod(config)#snmp-server community public ro 
rtr-cod(config)#write memory
Building configuration...

rtr-cod(config)#
```

#### admin-cod (alt-workstation):

* Переходим на **[https://srv1-cod.cod.ssa2026.region](https://srv1-cod.cod.ssa2026.region/)**
* Каждый хост необходимо зарегистрировать на сервере Zabbix, сделать это можно, используя веб-интерфейс
  + переходим **Monitoring -> Hosts -> Create host**:

![](../images/22_image__22__8de93a768c.png)

* Добавляем хосты в соответствие с требованиями задания:

![](../images/22_image__23__e8312a8727.png)

* Аналогично все остальные хосты:

![](../images/22_image__27__de6de01d8c.png)

Последнее изменение: пятница, 21 ноября 2025, 12:23